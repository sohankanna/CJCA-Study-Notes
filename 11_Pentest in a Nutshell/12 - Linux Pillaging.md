# 12 - Linux Pillaging


## 1. The Importance of Pillaging

With root access, we can bypass all file system permissions, allowing us to read critical configuration files, user data, and system secrets. This information is invaluable for:
*   **Finding more credentials:** Uncovering passwords and keys for other services or users.
*   **Lateral Movement:** Discovering SSH keys or credentials that can be used to access other machines on the network.
*   **Understanding the Environment:** Gaining a complete picture of the system's configuration and security posture.
*   **Data Exfiltration:** Identifying the "crown jewels"—the sensitive data the organization wants to protect.

---

## 2. Re-running Enumeration Scripts as Root

The first and most effective step in pillaging is to re-run an automated enumeration script like **LinPEAS**, but this time as the `root` user.

```shell
root@ubuntu:~# /home/john/linpeas.sh -a -N > /root/linpeas_root_results.txt
```

### Key Findings from the Root-Level LinPEAS Scan

Running the script with elevated privileges reveals several critical pieces of information that were previously hidden.

| Finding                            | Description                                                                                                                                                            | Security Impact                                                                                                                                                                                |
| :--------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **WordPress Database Credentials** | LinPEAS can now read the `wp-config.php` file and finds the database credentials in cleartext. <br> • **DB_USER:** `wpuser` <br> • **DB_PASSWORD:** `MyVeryStrongPa$$` | These credentials could be reused by administrators on other systems. This is a critical finding.                                                                                              |
| **Root's SSH Private Key**         | The script finds an SSH private key in `/root/.ssh/id_rsa`.                                                                                                            | **Critical.** This key likely belongs to a system administrator and may be used to authenticate to other high-value servers on the network. This is a primary vector for **lateral movement**. |
| **Root's Bash History**            | The script identifies the `/root/.bash_history` file.                                                                                                                  | This file contains a log of all commands run by the administrator, which can reveal server names, passwords, sensitive file locations, and internal procedures.                                |
| **Detailed AppArmor Profiles**     | The script can now fully read the AppArmor configuration, revealing that `snapd` and `lxd` (a container manager) are being restricted.                                 | Provides a deeper understanding of the host's security hardening.                                                                                                                              |
| **New Kernel Exploit Suggestion**  | The exploit suggester now identifies a *probable* vulnerability, **CVE-2022-32250**, that is relevant to the specific Ubuntu 22.04 kernel.                             | This confirms that even after gaining root, further vulnerability analysis can uncover additional weaknesses.                                                                                  |

---

## 3. The `linpill.sh` Script

In addition to general-purpose scripts like LinPEAS, specialized "pillaging" scripts can be used to quickly extract and organize key information into separate files.

*   **Execution:**
    ```shell
    root@ubuntu:~# bash linpill.sh
    ```
*   **Output:** The script creates a timestamped directory in `/tmp` containing neatly organized text files with the results of various enumeration commands (e.g., `CronJobs.txt`, `IPTablesRules.txt`, `Processes.txt`, `SUID_SGID.txt`). This is excellent for organized evidence collection.

---

## 4. Final Summary of Pillaging Findings

By combining the initial findings with the new information gathered as root, we have a complete picture of the Linux host.

| Category | Key Findings |
| :--- | :--- |
| **System Info** | Ubuntu 22.04.4, Kernel 5.15.0-135-generic, running in VMware. |
| **Credentials** | • **`john:SuperSecurePass123`** (from `.bash_history`) <br> • WordPress DB: **`wpuser:MyVeryStrongPa$$`** (from `wp-config.php`) |
| **SSH Keys** | • **`john`'s** private key (unencrypted) in `/home/john/.ssh/id_rsa` <br> • **`root`'s** private key in `/root/.ssh/id_rsa` |
| **Vulnerabilities**| • `hash-form` WordPress plugin RCE (CVE-2024-5084) <br> • Misconfigured `sudo` rule for `nano` (Privilege Escalation) <br> • Potential kernel exploit (CVE-2022-32250) |

With this wealth of information, the next logical step in a real engagement would be to use the discovered keys and credentials to attempt **lateral movement** to other hosts on the network, such as the Windows server (`10.129.12.20`).

